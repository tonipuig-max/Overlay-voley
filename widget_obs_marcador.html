<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>OBS Marcador Vóley Vivo</title>
<style>
  html,body{margin:0;padding:0;background:transparent}
  :root{
    --scale:16;
    --fg:#ffffff;
    --sub:#fffae5;
    --row1:rgba(255,102,0,0.65);     /* naranja vivo */
    --row2:rgba(0,128,255,0.65);     /* azul vivo */
    --border:#ffffff;                /* separador blanco */
    --badge:rgba(255,255,255,.25);
    --badge-bd:rgba(255,255,255,.6);
    --radius:10px;
    --gap:6px;
    --padY: calc(var(--scale)*0.25px);
    --padX: calc(var(--scale)*0.35px);
  }
  .wrap{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--fg);font-size:calc(var(--scale)*1px);line-height:1.1;display:inline-block}
  .head,.table{display:grid;gap:var(--gap)}
  .row{display:grid;align-items:center;gap:var(--gap);padding:var(--padY) var(--padX);border-radius:var(--radius);backdrop-filter:blur(2px)}
  .row:nth-child(odd){background:var(--row1)}
  .row:nth-child(even){background:var(--row2)}
  .cell{display:flex;align-items:center;justify-content:center;white-space:nowrap;min-width:calc(var(--scale)*1.6px)}
  .team{justify-content:flex-start;font-weight:800;overflow:hidden;text-overflow:ellipsis}
  .team-pill{display:inline-block;padding:2px 8px;border-radius:999px;background:var(--badge);border:1px solid var(--badge-bd)}
  .score{font-weight:900;font-variant-numeric:tabular-nums}
  .head .cell{color:var(--sub);text-transform:uppercase;font-weight:700;letter-spacing:.4px;padding:2px 0}
  .divider-h{border-left:3px solid var(--border);padding-left:calc(var(--padX))}
  .divider-b{border-left:3px solid var(--border)}
  .shadow-on *{text-shadow:0 2px 3px rgba(0,0,0,.55),0 0 12px rgba(0,0,0,.4)}
</style>
</head>
<body>
<div id="root" class="wrap">
  <div id="head" class="head"></div>
  <div id="table" class="table"></div>
</div>
<script>
(function(){
  const p=new URLSearchParams(location.search);
  const API=p.get('api')||''; const COLS=Math.min(5,Math.max(1,parseInt(p.get('cols')||'5',10)));
  const SCALE=Math.max(12,parseInt(p.get('scale')||'16',10));
  const SHOW_TOTALS=p.get('totals')==='1'; const SHADOW=p.get('shadow')==='1';
  document.documentElement.style.setProperty('--scale',SCALE);
  if(SHADOW)document.getElementById('root').classList.add('shadow-on');
  const $=s=>document.querySelector(s); const headEl=$('#head'),tableEl=$('#table');
  function gridTemplate(){return`minmax(${SCALE*7}px,1fr)`+' auto'.repeat(COLS)+(SHOW_TOTALS?' auto':'');}
  function buildHead(){headEl.innerHTML='';headEl.style.gridTemplateColumns=gridTemplate();const e=document.createElement('div');e.className='cell';headEl.appendChild(e);
    for(let i=1;i<=COLS;i++){const c=document.createElement('div');c.className='cell';c.textContent=`S ${i}`;headEl.appendChild(c);}
    if(SHOW_TOTALS){const c=document.createElement('div');c.className='cell divider-h';c.textContent='SETS';headEl.appendChild(c);}
  }
  function buildRow(lab){const r=document.createElement('div');r.className='row';r.style.gridTemplateColumns=gridTemplate();
    const t=document.createElement('div');t.className='cell team';t.innerHTML=`<span class="team-pill">${lab}</span>`;r.appendChild(t);
    for(let i=0;i<COLS;i++){const c=document.createElement('div');c.className='cell score';c.textContent='—';r.appendChild(c);}
    if(SHOW_TOTALS){const ct=document.createElement('div');ct.className='cell score divider-b';ct.textContent='0';r.appendChild(ct);}
    return r;}
  function init(n){headEl.innerHTML='';tableEl.innerHTML='';buildHead();tableEl.appendChild(buildRow(n.home));tableEl.appendChild(buildRow(n.away));}
  function render(n,h){if(!tableEl.children.length)init(n);const pillH=tableEl.children[0].querySelector('.team-pill');const pillA=tableEl.children[1].querySelector('.team-pill');
    if(pillH&&pillH.textContent!==n.home)pillH.textContent=n.home;if(pillA&&pillA.textContent!==n.away)pillA.textContent=n.away;
    const ph=[],pa=[];for(let i=0;i<COLS;i++){const r=h[i]||{};ph[i]=Number(r.points_home||0);pa[i]=Number(r.points_away||0);}
    const rowH=tableEl.children[0],rowA=tableEl.children[1];
    for(let i=0;i<COLS;i++){rowH.children[1+i].textContent=String(ph[i]??'—');rowA.children[1+i].textContent=String(pa[i]??'—');}
    if(SHOW_TOTALS){let th=0,ta=0;for(let i=0;i<COLS;i++){if(ph[i]>pa[i])th++;else if(pa[i]>ph[i])ta++;}rowH.children[1+COLS].textContent=th;rowA.children[1+COLS].textContent=ta;}}
  let last='';async function fetchData(){if(!API)return;try{const[rS,rH]=await Promise.all([fetch(API+'?t='+Date.now(),{cache:'no-store'}),fetch(API+'?type=history&t='+Date.now(),{cache:'no-store'})]);
    const js=await rS.json().catch(()=>({}));const jh=await rH.json().catch(()=>({history:[]}));const d=js.data||js||{};const hist=Array.isArray(jh.history)?jh.history:[];
    const n={home:String(d.team_home||'HOME'),away:String(d.team_away||'AWAY')};const snap=JSON.stringify({n,h:hist.map(r=>({ph:r.points_home,pa:r.points_away}))});
    if(snap!==last){last=snap;render(n,hist);}}catch(_){}}function loop(){fetchData().finally(()=>setTimeout(loop,1500));}
  init({home:'HOME',away:'AWAY'});buildHead();loop();
})();
</script>
</body>
</html>


